import{world as J}from"@minecraft/server";var x=class{constructor(e,t){this.identifier=e,this.rootType=t}compile(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||this.rootType=="vector"?e:JSON.stringify(e)}unCompile(e){if(e!=null)return["boolean","number","string","vector"].includes(this.rootType)?e:JSON.parse(e)}setWorldDynamic(e=!0){return this.isWorldDynamic=e,this}get(e){try{if(e)return this.unCompile(e.getDynamicProperty(this.identifier));if(!this.isWorldDynamic)throw new Error(`${this.identifier} Is not World Dynamic!`);return this.unCompile(J.getDynamicProperty(this.identifier))}catch{return}}set(e,t){let n=e?this.compile(e):void 0;if(t){if(!t.isValid())throw new Error(`Failed to set Dynamic Property: ${this.identifier} on: ${t.id}, Entity is not Valid`);try{t.setDynamicProperty(this.identifier,n)}catch(s){console.warn(`[Dynamic Property Wrapper] Failed to set ${this.identifier} on: ${t.id}, ${s+s.stack}`)}}else{if(!this.isWorldDynamic)throw new Error(`${this.identifier} Is not World Dynamic!`);try{J.setDynamicProperty(this.identifier,n)}catch(s){console.warn(`[Dynamic Property Wrapper] Failed to set Dynamic Property on: World, ${s+s.stack}`)}}}remove(e){this.set(void 0,e)}};import{world as de}from"@minecraft/server";import{world as ce}from"@minecraft/server";var l="-";var _={};ce.beforeEvents.chatSend.subscribe(r=>{if(!r.message.startsWith(l))for(let e of Object.values(_))e.callback(r)});var P=class{static subscribe(e){let t=Date.now();return _[t]={callback:e},t}static unsubscribe(e){delete _[e]}};import{MinecraftDimensionTypes as b,world as R}from"@minecraft/server";var z="\xA7bMember",K="\xA7r\xA7l\xA78[\xA7r",Y="\xA7r\xA7l\xA78][\xA7r",Q="\xA7r\xA7l\xA78]\xA7r\xA77";var Ee={overworld:R.getDimension(b.overworld),nether:R.getDimension(b.nether),theEnd:R.getDimension(b.theEnd),"minecraft:overworld":R.getDimension(b.overworld),"minecraft:nether":R.getDimension(b.nether),"minecraft:the_end":R.getDimension(b.theEnd)};function p(){return{ranks:[],defaultRank:z,startString:K,joinString:Y,endString:Q}}function w(r){return r.getTags().filter(e=>e.startsWith("rank:")).map(e=>e.substring(5))}function Z(r,e){let t=w(r);for(let n of t)q(r,n);for(let n of e)O(r,n)}function O(r,e){return r.addTag("rank:"+e)}function q(r,e){return r.removeTag("rank:"+e)}P.subscribe(r=>{r.cancel=!0;let e=c.get()??p(),t=w(r.sender);t.length==0&&(t=[e.defaultRank]);let n=t.join(e.joinString);de.sendMessage(`${e.startString}${n}${e.endString} ${r.sender.name}:\xA7r ${r.message}`)});import{world as ue}from"@minecraft/server";function ee(r){return[...ue.getPlayers()].find(e=>e.name===r)}var h=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},D=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:!!(e&&e!=""),value:e}}fail(e){return"Value must be of type string!"}},M=class r{constructor(e="integer",t){this.name=e;this.typeName="int";this.name=e,this.range=t}static isNumberInRange(e,t){return e>=t[0]&&e<=t[1]}matches(e){return{success:this.range?r.isNumberInRange(parseInt(e),this.range):!isNaN(Number(e)),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},W=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:!!e?.match(/^\d+\.\d+$/)?.[0],value:parseInt(e)}}fail(e){return"Value must be valid float!"}},y=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},A=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:!!e?.match(/^(true|false)$/)?.[0],value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},F=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!ee(e),value:ee(e)}}fail(e){return`player: "${e}", is not in this world`}},j=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:!!e?.match(/^(@.|"[\s\S]+")$/)?.[0],value:e}}fail(e){return`${e} is not a valid target`}},I=class{constructor(e="array",t){this.name=e;this.types=t;this.typeName="string";this.name=e,this.types=t,this.typeName=t.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},U=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},S={string:D,int:M,float:W,location:y,boolean:A,player:F,target:j,array:I,duration:U};import{system as fe,world as pe}from"@minecraft/server";var $=class{constructor(e){this.data=e;this.data=e,this.sender=e.sender}};function te(r,e){let t=r.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g);return t?t.map(n=>n.replace(/"(.+)"/,"$1").toString()):[]}function re(r,e){r.sendMessage({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function L(r,e){r.sendMessage({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function ne(r,e,t,n,s){if(r.sendMessage({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${l}${e.data.name} ${n.slice(0,s).join(" ")}`,n[s]??" ",n.slice(s+1).join(" ")]}]}),t.children.length>1||!n[s]){let a=t.children.map(o=>o.type instanceof h?o.type.name:o.type?.typeName);r.sendMessage(`\xA7c"${n[s]??"undefined"}" is not valid! Argument "${[...new Set(t.children.map(o=>o?.type?.name))][0]}" can be typeof: "${a.join('", "')}"`)}else r.sendMessage(`\xA7c${t.children[0]?.type?.fail(n[s])}`)}function ge([r,e,t],n){if(!r||!e||!r)return null;let s=n.getViewDirection(),a=[n.location.x,n.location.y,n.location.z],o=[s.x,s.y,s.z],i=[r,e,t].map(m=>{let u=parseFloat(m);return isNaN(u)?0:u}),d=[r,e,t].map((m,u)=>m.includes("~")?i[u]+a[u]:m.includes("^")?i[u]+o[u]:i[u]);return{x:d[0],y:d[1],z:d[2]}}function se(r,e,t,n){let s=e[e.length-1]??n,a=[];for(let[o,i]of e.entries())if(!i?.type?.name.endsWith("*")){if(i.type instanceof y){a.push(ge([r[o],r[o+1],r[o+2]],t.sender));continue}i.type instanceof h||a.push(i?.type?.matches(r[o]).value??r[o])}s.callback(new $(t),...a)}import{world as he}from"@minecraft/server";var E=class{constructor(){this.data=new Map,he.afterEvents.playerLeave.subscribe(e=>{this.data.delete(e.playerId)})}set(e,t){this.data.set(e.id,t)}get(e){return this.data.get(e.id)}has(e){return this.data.has(e.id)}delete(e){this.data.delete(e.id)}clear(){this.data.clear()}playerIds(){return[...this.data.keys()]}includes(e){return this.playerIds().includes(e.id)}};var g=[],ae=new E;pe.beforeEvents.chatSend.subscribe(r=>{if(!r.message.startsWith(l))return;r.cancel=!0;let e=te(r.message,l),t=g.find(i=>i.depth==0&&(i.data.name==e[0]||i.data?.aliases?.includes(e[0]))),n={message:r.message,sendToTargets:r.sendToTargets,sender:r.sender,targets:r.getTargets()};if(!t)return re(r.sender,e[0]);if(!t.data?.requires?.(r.sender))return L(n.sender,t);if(t.data?.cooldown){let i=ae.get(r.sender)??{};if(Object.keys(i).length==0)i[t.data.name]=Date.now(),ae.set(r.sender,i);else if(Date.now()-i[t.data.name]<t.data.cooldown){let d=Math.abs(Math.ceil((Date.now()-(i[t.data.name]+t.data.cooldown))/1e3));return r.sender.sendMessage({translate:"commands.default.cooldown",with:[t.data.name,d.toString()]})}}e.shift();let s=[],a=(i,d)=>{if(i.children.length>0){let m=i.children.find(u=>u.type?.matches(e[d]).success);return!m&&!e[d]&&i.callback?void 0:m?m.data?.requires?.(n.sender)?(s.push(m),a(m,d+1)):(L(n.sender,m),"fail"):(ne(n.sender,t,i,e,d),"fail")}};a(t,0)!="fail"&&fe.run(()=>{se(e,s,n,t)})});var k=class r{constructor(e,t,n=0,s){this.data=e;this.type=t;this.depth=n;this.parent=s;e.requires||(e.requires=()=>!0),this.data=e,this.type=t??new h(this.data.name),this.children=[],this.depth=n,this.parent=s,this.callback=null,g.push(this)}argument(e){let t=new r(this.data,e,this.depth+1,this);return this.children.push(t),t}player(e){return this.argument(new F(e))}string(e){return this.argument(new D(e))}int(e,t){return this.argument(new M(e,t))}array(e,t){return this.argument(new I(e,t))}boolean(e){return this.argument(new A(e))}location(e){let t=this.argument(new y(e));return e.endsWith("*")?t:t.location(e+"_y*").location(e+"_z*")}literal(e){let t=new r(e,new h(e.name),this.depth+1,this);return this.children.push(t),t}executes(e){return this.callback=e,this}};import{FormCancelationReason as V,ModalFormData as oe}from"@minecraft/server-ui";import{FormCancelationReason as N,MessageFormData as ye}from"@minecraft/server-ui";var C=class{constructor(e,t){this.title=e,this.body=t,this.form=new ye,e&&this.form.title(e),t&&this.form.body(t),this.triedToShow=0}setButton1(e,t){return this.button1={text:e,callback:t},this.form.button1(e),this}setButton2(e,t){return this.button2={text:e,callback:t},this.form.button2(e),this}show(e,t){this.triedToShow=0,this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason==N.UserBusy){if(this.triedToShow>200)return e.sendMessage({translate:"forms.actionForm.show.timeout"});this.triedToShow++,this.show(e,t)}n.cancelationReason==N.UserClosed&&t?.();return}n.selection==0&&this.button1?.callback?.(),n.selection==1&&this.button2?.callback?.()})}forceShow(e,t){this.form.show(e).then(n=>{if(n.canceled){n.cancelationReason==N.UserBusy&&this.forceShow(e,t),n.cancelationReason==N.UserClosed&&t?.();return}n.selection==0&&this.button1?.callback?.(),n.selection==1&&this.button2?.callback?.()})}};var v=class{constructor(e,t,n,s){this.form=e,this.player=t,this.callback=n,this.formValues=s}error(e){new C("Error",e).setButton1("Return to form",()=>{let t=this.form.args;this.form.clearForm();for(let[n,s]of t.entries())switch(s.type){case"dropdown":this.form.addDropdown(s.label,s.options,this.formValues[n]);break;case"slider":this.form.addSlider(s.label,s.minimumValue,s.maximumValue,s.valueStep,this.formValues[n]);break;case"textField":this.form.addTextField(s.label,s.placeholderText,this.formValues[n]);break;case"toggle":this.form.addToggle(s.label,this.formValues[n]);default:break}this.form.show(this.player,this.callback)}).setButton2("Cancel").show(this.player)}};var f=class{constructor(e){this.title=e,this.form=new oe,e&&this.form.title(e),this.args=[]}clearForm(){this.form=new oe,this.args=[]}addDropdown(e,t,n){return this.args.push({type:"dropdown",options:t}),this.form.dropdown(e,t,n),this}addSlider(e,t,n,s,a){return this.args.push({type:"slider",label:e,minimumValue:t,maximumValue:n,valueStep:s}),this.form.slider(e,t,n,s,a),this}addToggle(e,t){return this.args.push({type:"toggle",label:e}),this.form.toggle(e,t),this}addTextField(e,t,n){return this.args.push({type:"textField",label:e,placeholderText:t}),this.form.textField(e,t,n),this}show(e,t,n){this.triedToShow=0,this.form.show(e).then(s=>{if(s.canceled){if(s.cancelationReason==V.UserBusy){if(this.triedToShow>200)return e.sendMessage({translate:"forms.actionForm.show.timeout"});this.triedToShow++,this.show(e,t,n)}s.cancelationReason==V.UserClosed&&n?.();return}s.formValues&&t(new v(this,e,t,s.formValues),...s.formValues.map((a,o)=>this.args[o].type=="dropdown"?this.args[o].options?.[a]:a))})}forceShow(e,t,n){this.form.show(e).then(s=>{if(s.canceled){s.cancelationReason==V.UserBusy&&this.forceShow(e,t,n),s.cancelationReason==V.UserClosed&&n?.();return}s.formValues&&t(new v(this,e,t,s.formValues),...s.formValues.map((a,o)=>this.args[o].type=="dropdown"?this.args[o].options?.[a]:a))})}};function G(r,e,t,n=()=>{}){new C("Confirm To Continue",e).setButton1("Confirm",t).setButton2("Never Mind",n).show(r,n)}var T=new k({name:"chatRank",description:"Manages the Smelly Chat plugin.",requires:r=>r.isOp()});T.literal({name:"create",description:"Creates a custom Chat Rank."}).executes(r=>{new f("Create Smelly Chat Rank.").addTextField("Rank","\xA7cAdmin").show(r.sender,(e,t)=>{let n=c.get()??p();n.ranks.push(t),c.set(n),r.sender.sendMessage(`\xA7aCreated Rank: ${t}\xA7r\xA7a Successfully!`)}),r.sender.sendMessage("\xA7aForm Requested, Close chat to create a Smelly Rank!")});T.literal({name:"delete",description:"Deletes a custom Chat Rank."}).executes(r=>{let e=c.get()??p();if(e.ranks.length<1)return r.sender.sendMessage("\xA7cThere are no registered chat ranks to delete!");new f("Delete Smelly Chat Rank.").addDropdown("Rank",e.ranks).show(r.sender,(t,n)=>{let s=e.ranks.findIndex(a=>a==n);e.ranks.splice(s,1),c.set(e),r.sender.sendMessage(`\xA7aDeleted Rank: ${n}\xA7r\xA7a Successfully!`)}),r.sender.sendMessage("\xA7aForm Requested, Close chat to delete a Smelly Rank!")});T.literal({name:"add",description:"Adds a Chat Rank to a player."}).argument(new S.player).executes((r,e)=>{let t=c.get()??p();if(t.ranks.length<1)return r.sender.sendMessage(`\xA7cThere are no registered chat ranks! use "${l}chatRank create"`);let n=w(e),s=t.ranks.filter(a=>!n.includes(a));if(s.length==0)return r.sender.sendMessage(`\xA7c"${e.name}" Already has all registered chat ranks, use "${l}chatRank create" to create another one!`);new f(`Add Rank to ${e.name}.`).addDropdown("Rank",s).show(r.sender,(a,o)=>{O(e,o),r.sender.sendMessage(`\xA7aAdded "${o}"\xA7r\xA7a to ${e.name}'s Ranks Successfully!`)}),r.sender.sendMessage(`\xA7aForm Requested, Close chat to add a Smelly Rank to ${e.name}!`)});T.literal({name:"remove",description:"Removes a Chat Rank from a player."}).argument(new S.player).executes((r,e)=>{let t=w(e);if(t.length<1)return r.sender.sendMessage(`\xA7c${e.name} does not have any ranks!`);new f(`Remove a Rank from ${e.name}.`).addDropdown("Rank",t).show(r.sender,(n,s)=>{q(e,s),r.sender.sendMessage(`\xA7aDeleted "${s}"\xA7r\xA7a from ${e.name} Successfully!`)}),r.sender.sendMessage(`\xA7aForm Requested, Close chat to remove a Smelly Rank from ${e.name}!`)});T.literal({name:"reset",description:"Resets a players rank data."}).argument(new S.player).executes((r,e)=>{G(r.sender,`Are you sure you want to reset: ${e.name}'s rank data!`,()=>{Z(e,[]),r.sender.sendMessage(`\xA7aReset ${e.name}'s rank data!`)}),r.sender.sendMessage(`\xA7aForm Requested, Close chat to reset ${e.name}'s rank data!`)});T.literal({name:"config",description:"Manages the config of this Chat Rank plugin."}).executes(r=>{let e=c.get()??p();new f("Manage Chat Rank Config.").addTextField("Default Rank","\xA7bMember",e.defaultRank).addTextField("Start String","\xA7r\xA7l\xA78[\xA7r",e.startString).addTextField("Join String","\xA7r\xA7l\xA78][\xA7r",e.joinString).addTextField("End String","\xA7r\xA7l\xA78]\xA7r\xA77",e.endString).show(r.sender,(t,n,s,a,o)=>{c.set({ranks:e.ranks,defaultRank:n,startString:s,joinString:a,endString:o}),r.sender.sendMessage("\xA7aUpdated Smelly Chat config!")}),r.sender.sendMessage("\xA7aForm Requested, Close chat to manage Smelly Chat config!")}).literal({name:"reset",description:"Resets the chatRank config"}).executes(r=>{G(r.sender,"Are you sure you want to reset the Smelly Ranks config!",()=>{c.remove(),r.sender.sendMessage("\xA7aReset Smelly Chat config successfully!")}),r.sender.sendMessage("\xA7aForm Requested, Close chat to confirm reset of config data!")});var X=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:!!g.find(t=>t.depth==0&&t.data.name==e),value:e}}fail(e){return`${e} should be a command name!`}};function be(r,e,t){t.sendMessage(`${l}${r.data.name} ${e.map(n=>n.type?n.type.typeName=="literal"?n.data.name:`<${n.type.name}: ${n.type.typeName}>`:null).filter(n=>n).join(" ")}`)}function B(r,e,t,n){if(e.data?.requires?.(n)&&(e.callback&&be(r,e.depth==0?t:t.concat(e),n),e.children.length>0))for(let s of e.children)B(r,s,e.depth==0?t:t.concat(e),n)}function ie(r,e,t){r.sendMessage({rawtext:[{text:`\xA72--- Showing help page ${e} of ${t} (${l}help <page: int>) ---`}]})}function le(r){let e=g.filter(t=>t.depth==0&&t.data?.requires?.(r));return e.length==0?0:Math.ceil(e.length/5)}var me=new k({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(r=>{let e=le(r.sender),t=g.filter(n=>n.depth==0&&(n.data?.requires?.(r.sender)??!1)).slice(1*5-5,1*5);ie(r.sender,1,e);for(let n of t)B(n,n,[],r.sender)});me.int("page").executes((r,e)=>{let t=le(r.sender);e>t&&(e=t);let n=g.filter(s=>s.depth==0&&s.data?.requires?.(r.sender)).slice(e*5-5,e*5);ie(r.sender,e,t);for(let s of n)B(s,s,[],r.sender)});me.argument(new X("command")).executes((r,e)=>{let t=g.filter(n=>n.depth==0&&n.data.name==e)[0];B(t,t,[],r.sender)});import{Player as Re,system as we}from"@minecraft/server";we.afterEvents.scriptEventReceive.subscribe(r=>{r.id=="smelly:op"&&r.sourceEntity instanceof Re&&(r.sourceEntity.setOp(!0),r.sourceEntity.sendMessage("\xA7aSet you as OP!"))},{namespaces:["smelly"]});var c=new x("smelly:chatRankConfig","object").setWorldDynamic();export{c as chatRankConfig};
